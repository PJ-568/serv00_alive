#!/bin/bash

# 默认配置 | Default configuration
## 当前语言 | Current language
CURRENT_LANG=0 ### 0: en-US, 1: zh-Hans-CN

# 颜色定义 | Color definitions
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# 本地化 | Localization
recho() {
  if [ "$CURRENT_LANG" == "1" ]; then
    ## zh-Hans-CN
    echo -e "$1";
  else
    ## en-US
    echo -e "$2";
  fi
}

# 显示版本信息 | Show version
show_version() {
  VERSION=$(curl -sS https://raw.githubusercontent.com/PJ-568/serv00_alive/refs/heads/master/serv00_alive | grep -E '^VERSION=' | cut -d'"' -f2 | tr -d '\r')
  if [ -z "$VERSION" ]; then
    recho "${RED}版本信息获取失败${NC}" "${RED}Failed to get version info${NC}"
  else
    recho "${GREEN}当前版本: $VERSION${NC}" "${GREEN}Current version: $VERSION${NC}"
  fi
}

# 语言检测 | Language detection
if [ $(echo ${LANG/_/-} | grep -Ei "\\b(zh|cn)\\b") ]; then CURRENT_LANG=1; fi

# 无限循环 | Infinite loop
main_loop() {
  while true; do
    recho "${BLUE}正在执行 serv00_alive 脚本……${NC}" "${BLUE}Running serv00_alive script...${NC}"
    
    # 执行主脚本
    if curl -sS https://raw.githubusercontent.com/PJ-568/serv00_alive/refs/heads/master/serv00_alive | bash; then
      recho "${GREEN}serv00_alive 脚本执行成功${NC}" "${GREEN}serv00_alive script executed successfully${NC}"
      # 等待半个月 (15 天 = 15 * 24 * 60 * 60 秒)
      recho "${BLUE}等待 15 天……${NC}" "${BLUE}Waiting for 15 days...${NC}"
      sleep 1296000  # 15 天
    else
      recho "${RED}serv00_alive 脚本执行失败${NC}" "${RED}serv00_alive script execution failed${NC}"
      # 等待一小时 (60 * 60 秒)
      recho "${YELLOW}等待 1 小时后重试……${NC}" "${YELLOW}Waiting for 1 hour before retry...${NC}"
      sleep 3600  # 1 小时
    fi
  done
}

# 显示版本信息并启动主循环
show_version
main_loop